# language: java
# jdk: oraclejdk8


# env: 
#   global:
#   - secure: gvjUGE8096ajp9GDlPyoJdwJ9EAmez/P0xpjTyNwdrge0+lwyykKMXv/q/a/a83kPZl8hNomzvWKWaOsptYVpgcl+Fruolqbl0bsRcIXKgGaQo5yETzr2TXBTgSzrKaDmhj6fybuMspd6cZLwfc6GNy5JLu1ANIUkrlwxGbh/6u2GbzawJW5CMQT93sf5r9gdtaQI8bIHph99W4tBeWHPQZnQghhM5rxMiVMXVEaQ58nZvl/4HiK+8GT4KWhvxlUX94TwKdYeMBUsr4TSoQeAf4BeB7WdREoXURVkzYcUp/fXh4VOHYKAYKbLNT3BFwEIwfUFlxGXaY0P5mKyYnA6+ULj/TX3UGQSJnIKvnQ6wxlCNoHEsO9pacIzi24HCULhCKu5b7FOYRSN0y3bID3Pb423rVRsJE0sr/JZHCveQJXkdTSIGKcdsLPhnCkLjdcWXou1zI26BD2etQ2UCcn3jLEguXo4vYkvqe+eBYoDjNWMlZNjcG8Lu6HCJyoWDNh89cmwHAON+YQrDVUpdSTfW3j5keCURXQXuNbHNZUpsLni72iBKyAJwU8LOvJE4Uu2/4DdBmZPFrEfMW0xrP21KWmFv3odpu9aPq13tIntgnNfkytbQ6TB6j9Qgd8uchinh+RmNAUm6tbmILAti+T7J71RMwv1Ir52aET0ZQ+yhE=
#   - secure: dvvRteo/PR9xuaCPl9U5EtkHmVt7aOE/W5lujNGhqIYuu0YuxWpoezmerqeqrdpz3fFRa6gCAw2oiesFMdca5CdYKtzxd8WDe29+H1QAdt2m505nNTQUXpkLZmaWp+aUik4U0VN4/NVPmRYd3BXbOsTDBYoyHaj32FO1mZtbaMNXTbvpOsUlWla8kCC9LQyUxYaSirOFawMUmk4+OOziP4U9s+A83AiLycU0ZFUi8a824OsdbzZ2uXG5GGKg/D3kl84dlix8GXX41EryQn4cfkKGsoequRAcJFa7q6aLaSXqu7h07DyqHP0WUwSH8Gn+0QiqmYiBf81t+SbTS6Fm8d5+Lf0889nFt8s97VQomeq6Bk1PS6iohk9l4bJzGlJ6jrXkDsyC9KraWcJ8qAIL2u1RX+dwGMDfTzCKm3zLTJYomcPuv/Esc1w3DyvP4A8+Q12vepYFTucdPi7noXx90ZdepKqrnFHjgdiuVZoj5ZaHWhEN8z0RU2tU6TIBSZxyJl8zW6Xde4tg5cBdmh6QQIjNQ7dhk3vEa/quE5llcyNVacBluIEUkI5mjuUh1j8/VuY/vLHt4Jqj7Sk5q9lCqCkg4FQP02w4SXGldsZA5nZZTouPfoyiN2DxKqzxcyCau8XqBGBcFEU5XIraTrZupMPnVJ9JOgU+mbxx7s63P/w=
#   - secure: ZOyT+CKnPmCimX31w/RpxAldL3pTQOcf1QFLKjXE7VYr+Aiz85YUeuwy2cvdawmpuRF0MxKOm7GFx0ZVkj1t/UMZ4aXpnuttdOJaOLGeYavwQTswKli3N4EkwmXEeq45MMidTXLc3ei8fWZvqgAJNpHvaLTZpuimDxgoV+DLiVwm2YnsP2EsAz+nCMXAS+brMByiwc+cNjlvl1eaGAaffrq2D08GIKZhDT6Saf17PV4bIrHn2J9kNjlv0PharNOMENcSDf/OaAxogTqA98OC942LsmbTQs6rohsJUYLqlLADWdcOwyxoQXOoDaNDHhRAiqAoUGg4SEiMDhnY4+dAS3LomDEt6AU7B0olU6aZH6XCjbzVnVSXc6dlaR5VpnD7g0sZ3BpfLTNHxQbx9PygQjNbTatuv46tk7SwsnA6nyt8mh/M7fiqPGUTDrI4ADvjP5ethwK2nkB5q/SuB0nA63E1WQoPh9LGQXzN3NWeIcC0SnRZ3kVr9qWcTmhlnDu5cmb1x+mk/sE0E2Iu0c8Pax8HOtr/60k8Cl2ydqp/6M3SnO3QIMM3eCW/mKb08hqwgF50gU1TUpo1v0/KjJk/vb+PlLk+R3vBGSv/CRCELS3UmWv83wSy/cx3+gp0LnT2iiVUTAsS1lAaENR2EgYpgfaZdG1IWqIrqmZf/1K3mBE=



# services:
# - docker
# before_install:
# - sudo service mysql stop
# - docker pull takimatraining/devops-training-db
# - docker run -d -p 127.0.0.1:3306:3306 takimatraining/devops-training-db
# script:
# - mvn verify
# - |
#   mvn clean install sonar:sonar \
#   -Dsonar.projectKey=sampleApplicationStudents \
#   -Dsonar.organization=pcadorel-github \
#   -Dsonar.host.url=https://sonarcloud.io \
#   -Dsonar.plogin=22f8ee718db822f5161fad23048cf60ecca4a797

# # Login to Docker hub
# - docker login -u $DOCKER_USER -p $DOCKER_PASS
# # Tag text according to the branch
# - export TAG=`if [ "$TRAVIS_BRANCH" == "master" ]; then echo "latest"; else echo $TRAVIS_BRANCH; fi`
# # Image name
# - export IMAGE_NAME=takimatraining/sample-application
# # Build the image (see Dockerfile) and tag it with the commit ID
# - docker build -t $IMAGE_NAME:$TRAVIS_COMMIT .
# # Retag the image with the previously choosen tag
# - docker tag $IMAGE_NAME:$TRAVIS_COMMIT $IMAGE_NAME:$TAG
# # Push the tagged image to Docker Hub
# - docker push $IMAGE_NAME:$TAG

# notifications:
#   email:
#     on_failure: always
# cache:
#   directories:
#   - "$HOME/.m2/repository"


language: java
jdk: oraclejdk8
services:
- docker
before_install:
- sudo service mysql stop
- docker pull takimatraining/devops-training-db
- docker run -d -p 127.0.0.1:3306:3306 takimatraining/devops-training-db
script:
- mvn verify
- |
  mvn clean install sonar:sonar \
  -Dsonar.projectKey=sampleApplicationStudents \
  -Dsonar.organization=pcadorel-github \
  -Dsonar.host.url=https://sonarcloud.io \
  -Dsonar.login=$SONAR_TOKEN
  
    # Login to Docker hub
- docker login -u $DOCKER_USER -p $DOCKER_PASS
# Tag text according to the branch
- export TAG=`if [ "$TRAVIS_BRANCH" == "master" ]; then echo "latest"; else echo $TRAVIS_BRANCH; fi`
# Image name
- export IMAGE_NAME=$DOCKER_USER/sample-application
# Build the image (see Dockerfile) and tag it with the commit ID
- docker build -t $IMAGE_NAME:$TRAVIS_COMMIT .
# Retag the image with the previously choosen tag
- docker tag $IMAGE_NAME:$TRAVIS_COMMIT $IMAGE_NAME:$TAG
# Push the tagged image to Docker Hub
- docker push $IMAGE_NAME:$TAG
cache:
  directories:
  - "$HOME/.m2/repository"
env:
  global:
  - secure: gvjUGE8096ajp9GDlPyoJdwJ9EAmez/P0xpjTyNwdrge0+lwyykKMXv/q/a/a83kPZl8hNomzvWKWaOsptYVpgcl+Fruolqbl0bsRcIXKgGaQo5yETzr2TXBTgSzrKaDmhj6fybuMspd6cZLwfc6GNy5JLu1ANIUkrlwxGbh/6u2GbzawJW5CMQT93sf5r9gdtaQI8bIHph99W4tBeWHPQZnQghhM5rxMiVMXVEaQ58nZvl/4HiK+8GT4KWhvxlUX94TwKdYeMBUsr4TSoQeAf4BeB7WdREoXURVkzYcUp/fXh4VOHYKAYKbLNT3BFwEIwfUFlxGXaY0P5mKyYnA6+ULj/TX3UGQSJnIKvnQ6wxlCNoHEsO9pacIzi24HCULhCKu5b7FOYRSN0y3bID3Pb423rVRsJE0sr/JZHCveQJXkdTSIGKcdsLPhnCkLjdcWXou1zI26BD2etQ2UCcn3jLEguXo4vYkvqe+eBYoDjNWMlZNjcG8Lu6HCJyoWDNh89cmwHAON+YQrDVUpdSTfW3j5keCURXQXuNbHNZUpsLni72iBKyAJwU8LOvJE4Uu2/4DdBmZPFrEfMW0xrP21KWmFv3odpu9aPq13tIntgnNfkytbQ6TB6j9Qgd8uchinh+RmNAUm6tbmILAti+T7J71RMwv1Ir52aET0ZQ+yhE=
  - secure: dvvRteo/PR9xuaCPl9U5EtkHmVt7aOE/W5lujNGhqIYuu0YuxWpoezmerqeqrdpz3fFRa6gCAw2oiesFMdca5CdYKtzxd8WDe29+H1QAdt2m505nNTQUXpkLZmaWp+aUik4U0VN4/NVPmRYd3BXbOsTDBYoyHaj32FO1mZtbaMNXTbvpOsUlWla8kCC9LQyUxYaSirOFawMUmk4+OOziP4U9s+A83AiLycU0ZFUi8a824OsdbzZ2uXG5GGKg/D3kl84dlix8GXX41EryQn4cfkKGsoequRAcJFa7q6aLaSXqu7h07DyqHP0WUwSH8Gn+0QiqmYiBf81t+SbTS6Fm8d5+Lf0889nFt8s97VQomeq6Bk1PS6iohk9l4bJzGlJ6jrXkDsyC9KraWcJ8qAIL2u1RX+dwGMDfTzCKm3zLTJYomcPuv/Esc1w3DyvP4A8+Q12vepYFTucdPi7noXx90ZdepKqrnFHjgdiuVZoj5ZaHWhEN8z0RU2tU6TIBSZxyJl8zW6Xde4tg5cBdmh6QQIjNQ7dhk3vEa/quE5llcyNVacBluIEUkI5mjuUh1j8/VuY/vLHt4Jqj7Sk5q9lCqCkg4FQP02w4SXGldsZA5nZZTouPfoyiN2DxKqzxcyCau8XqBGBcFEU5XIraTrZupMPnVJ9JOgU+mbxx7s63P/w=
  - secure: ZOyT+CKnPmCimX31w/RpxAldL3pTQOcf1QFLKjXE7VYr+Aiz85YUeuwy2cvdawmpuRF0MxKOm7GFx0ZVkj1t/UMZ4aXpnuttdOJaOLGeYavwQTswKli3N4EkwmXEeq45MMidTXLc3ei8fWZvqgAJNpHvaLTZpuimDxgoV+DLiVwm2YnsP2EsAz+nCMXAS+brMByiwc+cNjlvl1eaGAaffrq2D08GIKZhDT6Saf17PV4bIrHn2J9kNjlv0PharNOMENcSDf/OaAxogTqA98OC942LsmbTQs6rohsJUYLqlLADWdcOwyxoQXOoDaNDHhRAiqAoUGg4SEiMDhnY4+dAS3LomDEt6AU7B0olU6aZH6XCjbzVnVSXc6dlaR5VpnD7g0sZ3BpfLTNHxQbx9PygQjNbTatuv46tk7SwsnA6nyt8mh/M7fiqPGUTDrI4ADvjP5ethwK2nkB5q/SuB0nA63E1WQoPh9LGQXzN3NWeIcC0SnRZ3kVr9qWcTmhlnDu5cmb1x+mk/sE0E2Iu0c8Pax8HOtr/60k8Cl2ydqp/6M3SnO3QIMM3eCW/mKb08hqwgF50gU1TUpo1v0/KjJk/vb+PlLk+R3vBGSv/CRCELS3UmWv83wSy/cx3+gp0LnT2iiVUTAsS1lAaENR2EgYpgfaZdG1IWqIrqmZf/1K3mBE=
