language: java
jdk: oraclejdk8
services:
- docker
before_install:
- sudo service mysql stop
- docker pull takimatraining/devops-training-db
- docker run -d -p 127.0.0.1:3306:3306 takimatraining/devops-training-db
script:
- mvn verify
- |
  mvn clean install sonar:sonar \
  -Dsonar.projectKey=sampleApplicationStudents \
  -Dsonar.organization=pcadorel-github \
  -Dsonar.host.url=https://sonarcloud.io \
  -Dsonar.login=22f8ee718db822f5161fad23048cf60ecca4a797
#login to Docker hub
- docker login -u $DOCKER_USER -p $DOCKER_PASS
#tag text according to the branch
- export TAG=`if [ "$TRAVIS_BRANCH" == "MASTER" ]; then echo "latest"; else echo $TRAVIS_BRANCH; fi`
- export IMAGE_NAME=$DOCKER_USER/sample-application
- docker build -t $IMAGE_NAME:$TRAVIS_COMMIT
- docker tag $IMAGE_NAME:$TRAVIS_COMMIT $IMAGE_NAME:$TAG
- docker push $IMAGE_NAME:$TAG


cache:
  directories:
  - "$HOME/.m2/repository"
  env:
  global:
    - secure: gvjUGE8096ajp9GDlPyoJdwJ9EAmez/P0xpjTyNwdrge0+lwyykKMXv/q/a/a83kPZl8hNomzvWKWaOsptYVpgcl+Fruolqbl0bsRcIXKgGaQo5yETzr2TXBTgSzrKaDmhj6fybuMspd6cZLwfc6GNy5JLu1ANIUkrlwxGbh/6u2GbzawJW5CMQT93sf5r9gdtaQI8bIHph99W4tBeWHPQZnQghhM5rxMiVMXVEaQ58nZvl/4HiK+8GT4KWhvxlUX94TwKdYeMBUsr4TSoQeAf4BeB7WdREoXURVkzYcUp/fXh4VOHYKAYKbLNT3BFwEIwfUFlxGXaY0P5mKyYnA6+ULj/TX3UGQSJnIKvnQ6wxlCNoHEsO9pacIzi24HCULhCKu5b7FOYRSN0y3bID3Pb423rVRsJE0sr/JZHCveQJXkdTSIGKcdsLPhnCkLjdcWXou1zI26BD2etQ2UCcn3jLEguXo4vYkvqe+eBYoDjNWMlZNjcG8Lu6HCJyoWDNh89cmwHAON+YQrDVUpdSTfW3j5keCURXQXuNbHNZUpsLni72iBKyAJwU8LOvJE4Uu2/4DdBmZPFrEfMW0xrP21KWmFv3odpu9aPq13tIntgnNfkytbQ6TB6j9Qgd8uchinh+RmNAUm6tbmILAti+T7J71RMwv1Ir52aET0ZQ+yhE=
    - secure: UXA5X7o61vY7e8dDo30sskKiuyHupPr/SAlniTe1fCWT1NBg3mvxxsnWpjzVRQEn4x2iQZmXQC0+s4Q+dvasdQ1P82xEFo7P8x4gzJMDDrYwEemnsNu4ASfYoLrPU7GTn8mv3cRuNLRtpoAsceuakGPK4dGLI5IQObBl3pK0/vCgFY7s1lNFL6LZKCoukVTDkwkehfBaa2qXrIHi4wctW+LBlHzP76Qg219yA78y6u2fXlo9aYANOMmrPyEY9hGBrPX5IOgL9b4V11bUOZcui+nxKnOgp/1QpltzUDIxtozn+tbggyWWXnxibzx0uzbdgxDdKQ3YDMgNK0FUigPbXSOS9SkqoUuoL89qbsOq6BOXA9w5xI1MvGE5qqc6iehYfj5CGlck8grPADjETt8U8UEV6P1K5A8yMAFU8j3zrj3hHS9vBDBNstuaV8B38ly14dgXHao4UlKo/VCvHmMK0ai/i2H911D+yMt6Tq7Tinccb3Pl5zfeCF49wprzbIMB8v3wvvbmgyAvLUdTwaFx8ApNoWnL6qn5txvrtthixGb6a8+SCK9/grYAt7SbsyGyViYmMswRqFCiVfHWIDYxsA0f+9QeC9mtnclzfTqpLULkXfLriGNZRwiyq8tx5x2yVVRIDIqNTXdiLtrdHetp3GM3D6paIC3rbLtYyoAD5HI=
    - secure: n80ne228keyb5OHShuXYae7p3Z+dZdl1KcJ92uvkzFuJ3ULLg9ZuEaQDFftqMgNo+/9RQ+BR68/IGHGuP+uXSrfAltrTAtLGn/IdleNAScWlhpAHR+FbINoc0qvPIxCn2T1Kd5mbnK8KQ7gx+4TmnogJ2x923oH8w55uUMVIoVLoGCoj8ITBZ4K9X41rcWiMb8PUGOMtW5ZQBoAo+NSUuAfW+ORzgK4Jbs3MvgHM3AHytUOQOmiXxii0ROs2tDzS0N2fMgzre7C7NvL3zKH/FcobPWLZNZ171crw4b4As9KGT2eXJDxgZTzHEqX0YVGMd+mkluVS9w6TWEo7MiEw0zwZ7kEJY4b+ECr9bqHVMA1M+CoiZazhDkaOu/OzcG2xnARCRpi7cIrkUR4mGJp3Ba1TjBAX9x+FklYHew93ajbC2WKjnlkoRBHCnrzSkGtxNg+nP6YhVgnNsPW6ip3g6aoBRzKdSLxHaEH6eDZIpMcjJwFqDExW7M4GltdnYDQyzC8OOLR9Q//HxWSBldMQmLEsL9OiM/+fks7UpC4e7mnszW9isspGXX7aScLPOHyVBY7K0v4u4YPACu3UiqclKO8+vzq17oVPHxcDOUeZpBQ2NjSGEtmbd+/WrBxdK3IAUPtxZAS/ipUHTmDM/N2W5SRDA3nZNn5e778gvSXANLw=


notifications:
  email:
    on_failure: always
